# 專案簡報：BMad Hacker Daily Digest

## 導言／問題說明

Hacker News（HN）留言串中蘊含珍貴洞見，但篇幅過長，難以通篇閱讀。BMad Hacker Daily Digest 專案旨在解決此問題，提供一種節省時間的方式，讓使用者能掌握 HN 討論中的集體智慧。此服務將每日自動擷取前 10 篇 HN 熱門文章，使用 Algolia HN API 取得其部分留言，並利用大型語言模型（LLM）生成連結文章（若可行）及留言討論的精簡摘要，最後以每日郵件簡報形式發送。此專案同時也是一個聚焦於代理驅動開發、TypeScript、Node.js 後端服務、API 整合及 Ollama 本地 LLM 使用的實作學習專案。

## 願景與目標

- **願景：** 提供快速、可靠且自動化的方式，讓使用者不需閱讀冗長留言串，便能掌握 Hacker News 社群中的關鍵洞察與討論。
- **主要目標（MVP - SMART）：**
  - **擷取 HN 文章資料：** 成功透過 Algolia HN Search API 取得前 10 篇 Hacker News 文章的 ID 與元資料（標題、網址、HN 連結）。
  - **擷取有限留言：** 對每篇文章，使用 Algolia HN Search API 取得預設且有限的留言子集。
  - **嘗試文章爬取：** 對每篇文章的外部網址，嘗試使用 Node.js 原生 fetch 與 article-extractor/Cheerio 等基本方法擷取原始 HTML 並萃取主要文章文字，並妥善處理失敗狀況。
  - **生成摘要（LLM）：** 利用本地 LLM（透過 Ollama、配置端點）生成：「文章摘要」（若成功爬取）及「討論摘要」兩種摘要。
  - **組合與寄送簡報（手動觸發）：** 將 10 篇文章結果格式化為單一 HTML 郵件，並在 CLI 手動觸發時，使用 Nodemailer 將簡報成功寄送至設定收件人清單。
- **成功指標（MVP 初期構想）：**
  - **成功執行：** 手動透過 CLI 觸發，流程完整執行且不當機，連續三次測試通過。
  - **簡報內容：** 產出郵件包含 10 篇文章結果（正確連結、討論摘要、可能含文章摘要），抽查內容具相關性。
  - **錯誤處理：** 爬取失敗時記錄錯誤，並繼續以留言摘要替代，不中斷整體流程。

## 目標使用者／用戶

**主要使用者（MVP）：** 執行此專案的開發者。主要動機為學習與展示代理驅動開發、TypeScript、Node.js（v22）、API 整合（Algolia、LLM、Email）、本地 LLM（Ollama）及設定管理（.env）等技術。關鍵需求為有趣且可達成的專案範圍。

**次要使用者（潛在）：** 時間有限的 HN 讀者／科技愛好者，需自動化的討論摘要。全面滿足此需求超出 MVP 範圍，但可作為未來方向參考。

## 主要功能／範圍（MVP 高階構想）

- 擷取 HN 熱門文章（Algolia API）。
- 擷取有限留言（Algolia API）。
- 本地檔案儲存（日期標記資料夾，結構化文字/JSON 檔案）。
- 嘗試基本文章爬取（Node.js v22 原生 fetch，簡易萃取）。
- 處理爬取失敗（記錄錯誤，改用留言摘要）。
- 生成摘要（本地 Ollama，配置端點：文章摘要（若有）、討論摘要）。
- 格式化簡報郵件（HTML：文章摘要（可選）、討論摘要、HN 連結、文章連結）。
- 手動寄送郵件（Nodemailer，認證資訊從 .env 讀取，收件人清單亦然）。
- CLI 觸發（手動指令執行完整流程）。

**MVP 明確不包含：** 進階爬取（JS 渲染、反機器人）、處理 _全部_ 留言／MapReduce 摘要、自動排程（cron）、資料庫整合、雲端部署／網頁前端、用戶管理（註冊等）、生產級錯誤處理／監控／投遞品質、LLM 提示微調、複雜重試邏輯。

## 已知技術限制或偏好

- **限制／偏好：**

  - **語言／執行環境：** TypeScript，運行於 Node.js v22。
  - **執行環境：** 本地機器執行為 MVP。
  - **觸發機制：** 僅手動 CLI 觸發為 MVP。
  - **設定管理：** 使用 `.env` 檔管理設定：LLM 端點 URL、郵件認證、收件人清單、留言擷取限制等。
  - **HTTP 請求：** 使用 Node.js v22 原生 fetch API（不使用 Axios）。
  - **HN 資料來源：** Algolia HN Search API。
  - **網頁爬取：** 基本且盡力而為（原生 fetch + 靜態 HTML 萃取），必須妥善處理失敗。
  - **LLM 整合：** 本地 Ollama，透過可配置端點。設計可未來切換至雲端 LLM。MVP 重功能勝於品質。
  - **摘要策略：** 分別生成文章摘要與討論摘要。限制每篇文章處理留言數（可配置）。不使用 MapReduce。
  - **資料儲存：** 本地檔案系統（結構化文字／JSON，日期標記資料夾）。無資料庫。
  - **郵件寄送：** Nodemailer。認證與收件人從 `.env` 讀取。基本設定，無生產投遞品質考量。
  - **主要目標背景：** 聚焦功能流程，供學習／示範。

- **風險：**
  - Algolia HN API 問題：變更、速率限制、可用性。
  - 網頁爬取脆弱性：高失敗機率，限制文章摘要產出。
  - LLM 變異與品質：本地 Ollama 表現不一，可能錯誤。
    *留言捕捉不完整：限制留言擷取可能漏關鍵洞察。
    *郵件設定／投遞：個人認證脆弱，可能被垃圾郵件過濾。
    *手動觸發依賴：僅手動執行產生簡報。
    *設定錯誤：錯誤的 `.env` 設定可能導致應用程式崩潰。
    _(使用者備註：已知風險並接受，因專案以學習為主。)_

## 相關研究（選填）

可行性：核心概念已透過現有 API／函式庫技術驗證可行。  
現有工具與市場背景：類似工具存在（驗證需求），但每日郵件格式較為獨特。  
API 選擇：選用 Algolia HN Search API 以利過濾與排序。  
技術挑戰確認：爬取複雜度與大量留言處理限制，影響 LLM 輸入大小，指引 MVP 範圍。  
本地 LLM 可行性：Ollama 已確認適用本地 MVP 開發測試，未來可替換。

## PM 提示

**PM 代理交接提示：BMad Hacker Daily Digest**

**關鍵洞察摘要：**

本專案簡報說明「BMad Hacker Daily Digest」，一款命令列工具，設計用於每日寄送來自熱門 Hacker News（HN）留言串的討論摘要。核心問題為閱讀冗長但有價值的 HN 討論所需時間過長。MVP 目標為擷取前 10 篇 HN 文章，透過 Algolia HN API 取得有限留言，嘗試簡易爬取連結文章（有備援機制），利用本地 LLM（Ollama）分別產生文章摘要（若有）與留言摘要，並使用 Nodemailer 寄送簡報郵件給開發者。此專案主要作為學習與示範代理驅動開發的 TypeScript 專案。

**需特別注意之處（供 PRD 參考）：**

- **留言選擇邏輯：** 定義從 Algolia 擷取「有限留言」的具體標準（如留言數量、最新留言、Token 數限制）。
- **基本爬取實作：** 詳述基本文章爬取步驟（使用 Node.js 原生 fetch、article-extractor/Cheerio 等），包含錯誤處理與備援機制。
- **LLM 提示語：** 定義生成「文章摘要」與「討論摘要」的精確提示語。
- **郵件格式：** 指定每日 HTML 郵件簡報的結構、版面與內容呈現方式。
- **CLI 介面：** 定義手動觸發的指令、參數及預期輸出／反饋。
- **本地檔案結構：** 定義中繼資料與日誌於本地文字檔，存放於日期標記資料夾的結構。

**開發背景說明：**

本簡報經過多次討論迭代，由一般應用構想逐步聚焦於 HN 討論與技術可行性，關鍵決策包括優先留言摘要、使用 Algolia HN API、採本地執行（Ollama、Nodemailer），及僅包含基本、盡力而為的爬取嘗試於 MVP。

**PRD 詳細指引：**

- 聚焦核心資料流程：HN API 擷取 → 留言選擇 → 基本爬取嘗試 → LLM 摘要（兩種）→ 郵件格式化與寄送 → CLI 觸發。
- 保留後續增強（雲端部署、前端、資料庫、進階爬取、排程）為高階未來考量。
- API／LLM 互動技術細節應具備彈性，便於未來替換（如 Ollama 換雲端 LLM）。

**使用者偏好：**

- 執行方式：MVP 以手動 CLI 觸發。  
- 資料儲存：MVP 使用本地文字檔。  
- LLM：MVP 使用 Ollama 本地模型，未來可切換雲端 API。  
- 摘要：分別產生文章（若有）與留言摘要。  
- API：使用 Algolia HN Search API。  
- 郵件：MVP 使用 Nodemailer 自寄。  
- 技術堆疊：TypeScript，Node.js v22。
