# PRD 產生任務

## 目的

- 將輸入轉換為符合 `prd-tmpl` 範本的核心產品定義文件。
- 定義清晰的 MVP 範疇，專注於必要功能。
- 為 Architect 及最終的 AI 開發代理程式提供基礎。

當您遵循接下來的指示時，請記住：

- 您的文件是整個開發流程的基礎。
- Architect 將直接使用輸出來建立架構文件和解決方案設計，以做出明確的技術決策。
- 您的 epics/stories 最終將轉換為開發任務。
- 雖然您專注於「做什麼」而非「如何做」，但請務必精確，以支援後續可合乎邏輯地遵循進一步細節的邏輯順序操作，其中 story 將完成所需內容。

## 指示

### 1. 定義專案工作流程情境

- 在產生 PRD 之前，請使用者選擇其預期的工作流程：

  A. **成果導向 (預設)：** (代理程式定義以成果為導向的 User Stories，將詳細的技術「如何做」留給 Architect/Scrum Master。在 Architect 的提示中，將細微差異記錄為「給 Architect/Scrum Master 的備註」。)

  B. **高度技術性 (不建議)：** (代理程式採取「解決方案感知」的立場，提供更詳細、更注重實作的 Acceptance Criteria，以銜接開發，可能完全不需要 architect 參與，而是由代理程式填寫所有技術細節。\<important_note\>選擇此工作流程時，您還需要負責在 PRD 範本中一個名為「[選用：僅適用於簡化 PM 至開發工作流程] 核心技術決策與應用程式結構」的全新專用章節中，協同定義並記錄關鍵技術基礎——例如技術堆疊選擇和建議的應用程式結構。\</important_note\>)

- 解釋此選擇設定了預設的詳細程度，之後可以針對每個 story/epic 進行微調。

### 2. 決定互動模式 (針對 PRD 結構與細節)

- 若未知，請與使用者確認其偏好的 PRD 建立互動風格：INCREMENTAL 或 YOLO？
  - **漸進式 (預設)：** 依序處理 PRD 各個章節，並針對每個章節尋求回饋。對於 Epics/Stories：首先呈現排序後的 Epic 清單以供核准，然後逐一詳述每個 Epic 的 stories。
  - **「YOLO」模式：** 草擬一份更全面的 PRD (或包含多個章節、epics 和 stories 的重要部分)，以進行單次、較大規模的審查。

### 3. 檢閱已提供的輸入

檢閱目前為止提供的輸入，例如專案簡報、任何研究以及使用者輸入和想法。

### 4. 處理 PRD 章節

告知使用者我們將依序逐一處理 PRD 各章節 (若非 YOLO 模式) - 範本中包含每個章節的指示。向使用者呈現該章節後，同時[提供進階自我完善與引出選項](#offer-advanced-self-refinement--elicitation-options)

<important_note>在處理 PRD 的「技術假設」章節時，明確引導使用者討論並決定儲存庫結構 (Monorepo vs. Polyrepo) 和高階服務架構 (例如，Monolith、Microservices、Monorepo 內的 Serverless functions)。強調這是一個關鍵決策點，將在此處正式記錄其理由，影響 MVP 範疇並通知 Architect。確保此決策記錄在 PRD 的 `Technical Assumptions` 中，然後在 PRD 的 `Initial Architect Prompt` 章節中重申。</important_note>

<important_note>特別針對「簡化 PM 至開發工作流程」：
在討論初始 PRD 章節 (如問題、目標、使用者畫像) 之後，以及在定義詳細 Epics 和 Stories 之前或同時，您必須引入並填寫 PRD 的「[選用：僅適用於簡化 PM 至開發工作流程] 核心技術決策與應用程式結構」章節。

    執行此操作時，首先檢查是否存在 `docs/technical-preferences.md` 檔案或是否已提供。若存在，告知使用者您將參考該檔案以協助引導這些技術決策，同時仍與他們確認所有選擇。提出針對性問題，例如：

1.  「您對後端和前端 (若適用) 的主要程式語言和框架有什麼初步想法？(我將交叉引用您在 `technical-preferences` 中註明的任何偏好設定。)」
2.  「您正在考慮使用哪個資料庫系統？(正在檢查偏好設定...)」
3.  「在此階段，是否有任何特定的雲端服務、關鍵函式庫或部署平台需要我們規劃？(正在檢查偏好設定...)」
4.  「您如何設想應用程式的高階資料夾結構或主要模組？您能描述一下關鍵元件及其職責嗎？(我會考慮任何已註明的結構偏好設定。)」
5.  「這會是一個 monorepo，還是您考慮為應用程式的不同部分使用獨立的儲存庫？」
    如果後續的 epic/story 討論揭示了新的需求或限制，則應協同填寫並視需要更新此章節。

</important_note>

<important_note>

對於 Epic 和 Story 章節 (若針對這些內容處於漸進模式)，請在記憶體中準備您認為的初始 epic 和 story 清單，以便我們可以漸進地處理此問題，利用您目前為止學到的所有資訊來遵循下方章節 [Epic 與 User Story 產生的指導原則](https://www.google.com/search?q=%23guiding-principles-for-epic-and-user-story-generation) 中的指南。

</important_note>

#### 4A. Epic 呈現與草擬策略

您將首先向使用者呈現 epic 標題和描述，以便使用者可以判斷其是否正確以及預期內容，或者是否存在遺漏的重要 epic。

#### 4B. Epic 內的 Story 產生與審查 (漸進模式)

**一旦 Epic 清單獲得核准，則針對每個 Epic，您將按如下方式進行：**

i. **草擬目前 Epic 的所有 Stories：** 根據 Epic 的目標和您的討論，遵循「Epic 與 User Story 產生的指導原則」，草擬此 Epic 所需的所有 User Stories。
ii. **執行內部 Story 分析並提議順序：** 在呈現 stories 以進行詳細審查之前，您將在內部：
a. **重新評估橫切關注點：** 根據指導原則，確保沒有任何已草擬的 stories 實際上應該是其他 stories 內的 ACs 或備註。進行必要的調整。
b. **分析邏輯順序與相依性：** 對於此 Epic 內的所有 stories，決定其邏輯實作順序。識別任何直接的先決條件 stories (例如，「Story X 必須在 Story Y 之前完成，因為 Y 使用 X 的輸出」)。
c. **闡述順序的理由：** 準備一份簡短的解釋，說明為何提議的順序是合乎邏輯的。
iii. **呈現 Epic 的提議 Story 集合與順序：** 向使用者呈現：
a. Epic 的 (可能已修訂的) User Stories 完整清單。
b. 這些 stories 的提議順序。
c. 您對排序的簡要理由以及您注意到的任何關鍵相依性 (例如，「我建議此順序，因為 Story 2 建立在 Story 1 中準備的資料之上，而 Story 3 接著使用 Story 2 的結果」)。
iv. **協同審查順序與 Story 框架：** 與使用者討論此提議的結構和順序。根據使用者回饋調整 story 清單或其順序。
v. 一旦 Epic 的 stories 整體結構和順序達成一致，THEN 您將與使用者一起，按照該 Epic 約定的順序，審查每個 story 的詳細內容 (描述、Acceptance Criteria)。
vi. [提供進階自我完善與引出選項](#offer-advanced-self-refinement--elicitation-options)

#### 4C. 呈現完整草稿

一旦所有章節完成 (或根據 YOLO 模式互動)，向使用者呈現完整的草稿。

#### 4D. UI 元件交付備註

如果此 PRD 包含 UI 元件，您可以告知使用者 Design Architect 應採用此最終輸出。

### 5. 檢查清單評估

- 使用 `pm-checklist` 來考量檢查清單中的每個項目是否已針對 PRD 達成 (或不適用)。
- 記錄每個項目的完成狀態。
- 在進入下一節之前，向使用者呈現檢查清單各節的摘要。
- 與使用者一起解決不足之處，以獲取輸入或建議的更新或更正。
- 完成並處理後，輸出最終的檢查清單，其中包含所有已勾選或跳過的項目、章節摘要表以及任何最終備註。檢查清單也應包含任何已討論並解決或忽略的發現。這對使用者來說將會是一個很好的產出文件。

### 6. 產生 PRD

根據 `prd-tmpl` 並利用以下指南產生包含 PM 提示的 PRD：

**一般呈現與內容：**

- 以乾淨、完整的格式呈現專案簡報 (草稿或最終版本)。
- 至關重要的是，請勿截斷與先前版本相比未變更的資訊。
- 對於完整文件，直接從內容開始 (不需要引言文字)。

<important_note>
**UI/UX 規格的後續步驟 (若適用)：**

- 如果此 PRD 中描述的產品包含使用者介面：

  1.  **在 PRD 中包含 Design Architect 提示：** 您將在您正在產生的 PRD 文件中新增一個專用章節，具體位置在標示為 `(END Checklist START Design Architect UI/UX Specification Mode Prompt)` 的地方 (根據 `prd-tmpl` 結構)。此章節將包含給 **Design Architect** 代理程式的提示。

      - 提示應明確指出 Design Architect 將在其 **「UI/UX Specification Mode」**下運作。

      - 應指示 Design Architect 使用此 PRD 作為主要輸入，以協同定義和記錄詳細的 UI/UX 規格。這可能涉及建立/填寫 `front-end-spec-tmpl` 並確保關鍵的 UI/UX 考量因素已整合或參考回 PRD 以使其更豐富。

      - 要插入的範例提示文字：

        ```markdown
        ## 給 Design Architect 的提示 (UI/UX Specification Mode)

        **目標：** 詳細闡述此 PRD 中定義產品的 UI/UX 層面。
        **模式：** UI/UX Specification Mode
        **輸入：** 此已完成的 PRD 文件。
        **關鍵任務：**

        1. 檢閱此處的產品目標、user stories 以及任何與 UI 相關的備註。
        2. 協同定義詳細的使用者流程、線框圖 (概念性) 以及關鍵畫面模型/描述。
        3. 指定可用性需求和無障礙考量。
        4. 填寫或建立 `front-end-spec-tmpl` 文件。
        5. 確保此 PRD 已更新或清楚參考從您的工作中衍生的詳細 UI/UX 規格，以便為後續的架構和開發階段提供全面的基礎。

        請引導使用者完成此流程，以詳細的 UI/UX 規格豐富 PRD。
        ```

  2.  **建議使用者工作流程：** 在完成此 PRD (包含給 Design Architect 的提示) 後，強烈建議使用者依下列順序進行：
      a. 首先，讓 **Design Architect** 代理程式 (使用您嵌入 PRD 中的提示) 在 **「UI/UX Specification Mode」**下運作。解釋此步驟對於詳細說明使用者介面和體驗至關重要，其輸出 (例如，已填寫的 `front-end-spec-tmpl` 和可能更新的 PRD 章節) 將非常重要。
      b. 其次，在 Design Architect 完成其 UI/UX 規格工作*之後*，使用者應接著讓 **Architect** 代理程式 (使用同樣包含在此 PRD 中的「Initial Architect Prompt」) 參與。現在已包含 UI/UX 細節的 PRD，將為技術架構設計提供更完整的基礎。

- 如果產品不包含使用者介面，您只需建議使用 PRD 中的「Initial Architect Prompt」讓 Architect 代理程式繼續進行。
  </important_note>

## Epic 與 User Story 產生的指導原則

### I. 策略基礎：嚴謹定義核心價值與 MVP 範疇

了解並釐清核心需求：首先深入了解並釐清此產品解決的核心問題、已定義使用者畫像 (或系統參與者) 的基本需求，以及 Minimum Viable Product (MVP) 的關鍵業務目標。
持續挑戰範疇：在每個階段積極挑戰所有被要求的功能和範疇。對於每個潛在功能或 story，嚴格提問：「這是否直接支援核心 MVP 目標並為目標使用者畫像提供顯著價值？」清楚識別並將非必要功能延後至 MVP 後的 backlog。

### II. 建構工作：價值驅動的 Epics 與邏輯排序

組織成可部署、價值驅動的 Epics：將 MVP 範疇組織成 Epics。每個 Epic 必須設計為能交付一個重要的、端到端的、且完全可部署的可測試功能增量，為使用者或業務提供實質價值。Epics 應代表邏輯功能區塊或連貫的使用者旅程。

邏輯 Epic 排序與基礎工作：
確保 Epics 的順序遵循邏輯實作順序，使 Epics 之間的相依性清晰且明確管理。
第一個 Epic 必須始終建立支援其自身可部署功能以及後續 Epics 功能所需的基礎專案基礎設施 (例如，初始應用程式設定、Git 儲存庫、CI/CD 管線、核心雲端服務組態、若普遍需要則為基本使用者驗證框架)。
確保 Epic 內的邏輯 Story 排序和相依性意識：
在初步草擬 Epic 的所有 User Stories 之後，但在與使用者詳細審查之前，您 (執行此任務的 AI 代理程式) 必須明確執行內部審查以建立這些 stories 的邏輯順序。
對於每個 story，識別其是否在同一個 Epic 內或來自已完成的 Epics 中有直接的先決條件 stories。
向使用者提議一個清晰的 story 順序，並根據這些相依性解釋其理由 (例如，「Story X 需要在 Story Y 之前完成，因為...」)。使重要的相依性可見，或許可以在 story 描述中註明。

### III. 打造有效的 User Stories：專注於價值與清晰度的垂直切片

將 Stories 定義為「垂直切片」：在每個 Epic 中，將 User Stories 定義為「垂直切片」。這表示每個 story 必須交付一個完整的功能片段，以達成特定的使用者或系統目標，並可能貫穿所有必要的層次 (例如，UI、API、業務邏輯、資料庫)。
專注於「做什麼」和「為什麼」，而非「如何做」：
Stories 將主要專注於功能成果、使用者價值 (「做什麼」) 以及原因 (「為什麼」)。避免在 story 的主要描述中詳述技術實作 (「如何做」)。
「身為一位 {特定的使用者畫像/系統參與者}，我想要 {執行一個動作/達成一個目標} 以便於 {我能實現一個益處/達成一個原因}」是標準格式。在定義「{特定的使用者畫像/系統參與者}」時務必精確且一致，確保其與已定義的畫像一致。
確保使用者價值，而非僅技術任務：User Stories 必須闡明清晰的使用者或業務價值。避免建立純粹是技術任務的 stories (例如，「設定資料庫」、「重構模組 X」)，除非它們是基礎設施 Epic 的一部分，或者是與提供價值的使用者導向 story 明確連結並合理化的必要促成任務。
適當規模並力求獨立性：
確保 User Stories 的規模適合典型的開發迭代 (即團隊可以在一個 sprint/iteration 中完成)。
如果一個垂直切片的 story 過大或過於複雜，請與使用者合作將其拆分為更小、仍具價值且仍為垂直切片的增量。
在可行的情况下，定義 stories 使其可以獨立於其他 stories 進行開發、測試和潛在交付。如果相依性不可避免，則必須透過排序清楚識別和管理。

### IV. 詳述 Stories：全面的 Acceptance Criteria 與開發者賦能

清晰、全面且可測試的 Acceptance Criteria (ACs)：
每個 User Story 都將有詳細、明確且可測試的 Acceptance Criteria。
ACs 從功能角度精確定義該 story 的「完成」標準，並作為驗證的基礎。
當 PRD 中的特定 Non-Functional Requirement (NFR) (例如，特定動作的特定效能目標、處理某些資料的安全限制) 對某個 story 至關重要時，確保在其 Acceptance Criteria 中明確記錄或清楚參考。
將開發者賦能與迭代設計整合至 Stories：
本地可測試性 (CLI)：對於涉及後端處理或資料元件的 User Stories，確保 ACs 考量或指定開發者能夠在本地測試該功能的能力 (例如，透過 CLI 指令、本地服務實例)。
迭代綱要定義：資料庫綱要變更 (新資料表、欄位) 應在功能上需要它們的 User Stories 中迭代引入，而非預先定義整個綱要。
前期 UI/UX 標準 (若適用 UI)：對於包含 UI 元件的 User Stories，ACs 應從一開始就明確說明有關外觀與風格、響應式設計以及遵循所選框架/函式庫 (例如，Tailwind CSS、shadcn/ui) 的要求。

### V. 管理複雜性：有效處理橫切關注點

嚴格評估橫切關注點：
在最終確定 User Story 之前，評估所描述的功能是否確實是一個獨立的、面向使用者的價值片段，或者它是否代表一個橫切關注點 (例如，特定的日誌記錄需求、許多視圖使用的 UI 主題元素、多個其他 stories 的核心技術促成因素、錯誤處理的特定方面)。
如果某項功能被識別為橫切關注點：
a. 避免為其建立獨立的 User Story，除非它能提供獨立的、可測試的使用者價值。
b. 相反地，將該需求整合為其影響的所有相關 User Stories 中的特定 Acceptance Criteria。
c. 或者，如果它是一個普遍的技術促成因素或廣泛適用的非功能性需求，則在相關的 PRD 章節 (例如，「Non Functional Requirements」、「Technical Assumptions」) 中清楚記錄，或者如果非常具體，則在 story 描述中作為給 Architect 的備註。

您的目標是確保 User Stories 始終專注於交付可衡量的使用者價值，同時仍適當地記錄所有必要的技術和功能細節。

### VI. 確保品質與順暢交付

維持交付清晰度與架構自由度：User Stories、其描述和 Acceptance Criteria 必須足夠詳細，以便為 Architect 提供對「需要什麼」的清晰而全面的理解，同時允許在「如何做」方面具有架構彈性。
確認「就緒」狀態：在考慮 Epic 的 stories 完成之前，確保每個 story 都有效地「就緒」以進行後續的架構審查或開發規劃——這意味著它清晰、易懂、可測試、其相依性已註明，並且任何基礎工作 (例如來自第一個 epic 的工作) 都已納入考量。

## 提供進階自我完善與引出選項

(此章節在需要時於此之前調用)

向使用者呈現以下「進階反思、引出與腦力激盪行動」清單。解釋這些是選用步驟，有助於在最終確定並繼續進行之前，確保品質、探索替代方案並加深對目前章節的理解。使用者可以透過數字選擇一個行動，或選擇跳過此步驟並繼續最終確定該章節。

「為確保目前章節的品質：**[特定章節名稱]** 並確保其穩健性、探索替代方案並考量所有角度，我可以執行以下任何行動。請選擇一個數字 (8 表示最終確定並繼續)：

**我可以採取的進階反思、引出與腦力激盪行動：**

{給 AI 代理程式的指示：顯示下方每個編號項目的標題。如果使用者詢問特定選項的含義，請根據針對該情境量身打造的詳細描述，簡要解釋您將採取的行動。}

1.  **批判性自我審查與使用者目標對齊**
2.  **產生並評估替代設計解決方案**
3.  **使用者旅程與互動壓力測試 (概念性)**
4.  **深入探討設計假設與限制**
5.  **可用性與無障礙稽核審查與探究性問題**
6.  **協同構思與 UI 功能腦力激盪**
7.  **引出「未預見的使用者需求」與未來互動問題**
8.  **最終確定此章節並繼續。**

在我執行所選行動後，我們可以討論結果並決定此章節的任何進一步修訂。」

重複詢問使用者是否願意執行另一個反思、引出與腦力激盪行動，直到使用者表示可以繼續進行下一章節 (或選擇 #8)。
