# 建立前端架構任務

## 目的

定義前端應用程式的技術架構。這包括選擇適當的模式、建構程式碼庫、定義組件策略、規劃狀態管理、概述 API 互動，以及設定測試和部署方法，同時遵守 `front-end-architecture-tmpl` 範本中的指南。

## 輸入

- 產品需求文件 (PRD) (`prd-tmpl` 或同等文件)
- 已完成的 UI/UX 規格書 (`front-end-spec-tmpl` 或同等文件)
- 主要系統架構文件 (`architecture` 或同等文件) - 執行此任務的代理程式應特別注意此處詳述的整體系統結構 (Monorepo/Polyrepo、後端服務架構)，因為它會影響前端模式。
- 主要設計檔案 (Figma、Sketch 等，從 UI/UX 規格書連結)

## 主要活動與指示

### 1. 確認互動模式

- 詢問使用者：「您希望如何進行前端架構的建立？我們可以採用以下方式：
  A. **漸進式 (預設且建議)：** 我們將逐步完成每個架構決策和文件章節。我會提出草稿，並在進入下一部分之前尋求您的回饋和確認。這最適合複雜的決策和詳細的調整。
  B. **「YOLO」模式：** 我可以為您產生一份更全面的前端架構初步草稿，供您進行更廣泛的審查。然後我們可以根據您的回饋對特定部分進行迭代。這種方式可以更快地產生初步想法，但如果偏好在每個步驟進行詳細協作，則通常不建議使用。」
- 要求使用者選擇他們偏好的模式 (例如，「請告訴我您偏好 A 或 B。」)。
- 使用者選擇後，確認所選模式 (例如，「好的，我們將以漸進模式進行。」)。所選模式將決定後續步驟的執行方式。

### 2. 檢閱輸入並建立情境

- 徹底檢閱輸入，包括 UI/UX 規格書和主要架構文件 (尤其是「最終技術堆疊選擇」、API 合約以及記錄的整體系統結構，如 monorepo/polyrepo 選擇)。
- 提出澄清問題，以彌補 UI/UX 願景與整體系統架構之間的任何差距。

### 3. 定義整體前端理念與模式 (針對 `front-end-architecture`)

- 根據主要架構的技術堆疊和整體系統結構 (monorepo/polyrepo、後端服務細節)，確認並詳述：
  - 框架與核心函式庫的選擇。
  - 高階組件架構策略。
  - 高階狀態管理策略。
  - 資料流原則。
  - 樣式設定方法。
  - 將採用的關鍵設計模式。

### 4. 指定詳細的前端目錄結構 (針對 `front-end-architecture`)

- 協作定義或調整前端特定的目錄結構，確保其與所選框架一致並促進模組化和可擴展性。

### 5. 概述組件策略與慣例 (針對 `front-end-architecture`)

- 定義組件命名與組織慣例。
- 建立「組件規格範本」(依照 `front-end-architecture`)，強調大多數組件將會逐步詳述，但必須遵循此範本。
- 可選擇性地指定一些絕對基礎/共用的 UI 組件 (例如，如果所選的 UI 函式庫需要，或者未使用 UI 函式庫，則指定通用的按鈕或模態框包裝器)。

### 6. 詳述狀態管理設定與慣例 (針對 `front-end-architecture`)

- 根據高階策略，詳述：
  - 所選解決方案和核心設定。
  - Store 結構 / Slices 的慣例 (例如，「基於功能的 slices」)。定義任何真正的全域/核心 slices (例如，session/auth)。
  - Selectors 和 Actions/Reducers/Thunks 的慣例。提供範本或範例。

### 7. 規劃 API 互動層 (針對 `front-end-architecture`)

- 定義 HTTP 客戶端設定。
- 建立服務定義的模式 (API 呼叫將如何封裝)。
- 概述 API 呼叫的前端錯誤處理與重試策略。

### 8. 定義路由策略 (針對 `front-end-architecture`)

- 確認路由函式庫。
- 協作定義主要路由定義和任何路由守衛。

### 9. 指定建置、打包和部署細節 (針對 `front-end-architecture`)

- 概述前端特定的建置流程與腳本。
- 討論並記錄關鍵的打包優化。
- 確認與前端相關的 CDN/託管部署細節。

### 10. 調整前端測試策略 (針對 `front-end-architecture`)

- 詳細說明主要測試策略，並針對以下方面提供具體細節：組件測試、UI 整合/流程測試，以及 E2E UI 測試的範圍和工具。

### 11. 概述效能考量 (針對 `front-end-architecture`)

- 列出將採用的關鍵前端特定效能策略。

### 12. 文件草擬與確認 (遵循 `front-end-architecture-tmpl`)

- **如果選擇了「漸進模式」：**

  - 對於 `front-end-architecture` 的每個相關章節 (如上述步驟 3-11 所述，涵蓋從整體理念到效能考量的主題)：

    - **a. 解釋目的並草擬章節：** 解釋章節的目的並提出該章節的草稿。
    - **b. 初步討論與回饋：** 與使用者討論草稿，納入其回饋，並視需要進行迭代以進行初步修訂。
    - **c. 提供進階反思與引導選項：**
      <critical_rule>在納入使用者對草擬的前端架構章節的第一輪回饋後，您接著將向使用者呈現以下「進階反思、引導與腦力激盪行動」清單。解釋這些是選用步驟，有助於在最終確定並繼續之前，確保品質、探索替代方案並加深對目前草稿的理解。使用者可以透過數字選擇一個行動，或選擇跳過此步驟並繼續最終確定該章節。</critical_rule>

      「我們已將您的初步回饋納入目前前端架構章節的草稿中：**[特定前端架構章節名稱]**。為確保其穩健性、探索替代方案並考量所有角度，我可以執行以下其中一項行動。請選擇一個數字，或告訴我您是否準備好最終確定此章節：

      **我可以採取的進階反思、引導與腦力激盪行動：**

      {AI 代理程式指示：僅顯示以下每個編號項目的標題。如果使用者詢問特定選項的含義，請根據針對前端架構情境量身打造的詳細描述，簡要說明您將採取的行動。}

      1.  **嚴格自我審查與需求對齊**
      2.  **產生並評估替代架構方法**
      3.  **韌性、可擴展性與效能壓力測試 (概念性)**
      4.  **深入探討技術假設、限制與依賴關係**
      5.  **可維護性與可測試性稽核審查與探究性問題**
      6.  **協作設計腦力激盪與模式/技術探索**
      7.  **引導「未預見的影響」與未來驗證問題**
      8.  **最終確定此章節並繼續。**

      在我執行所選行動後，我們可以討論結果並決定此章節的任何進一步修訂。」

    - **d. 最終核准與文件記錄：** 取得使用者對該章節的明確核准。確保每個章節中的所有預留位置連結和參考都已正確註明。然後繼續下一個章節。

  - 一旦所有章節都透過此流程個別核准，請向使用者確認整體 `front-end-architecture` 文件已填寫完畢，並準備好進行步驟 13 (Epic/Story 影響) 和步驟 14 (檢查清單審查)。

- **如果選擇了「YOLO 模式」：**
  - 協作填寫 `front-end-architecture-tmpl` 的所有相關章節 (如上述步驟 3-11 所述)，以建立一份全面的初稿。
  - 將 `front-end-architecture` 的完整草稿呈現給使用者進行整體審查。
  - <important_note>在 YOLO 模式下呈現完整草稿後，如果使用者希望在詳細的逐節回饋之前進行結構化的深入探討，您仍然可以提供「進階反思與引導選項」選單的精簡版本，或許著重於一些關鍵的總體審查行動 (例如，整體需求對齊、主要風險評估)。</important_note>
  - 在繼續步驟 13 (Epic/Story 影響) 和步驟 14 (檢查清單審查) 之前，取得使用者對整個 `front-end-architecture` 文件的明確核准。

### 13. 識別並總結 Epic/Story 影響 (前端焦點)

- 在 `front-end-architecture` 確認後，根據現有的 epics 和 user stories (如果已提供或已知) 進行檢閱。
- 識別任何可能需要作為新 stories 或子任務新增的前端特定技術任務 (例如，「根據定義的斷點實作產品詳細資料頁面的響應式佈局」、「為使用者個人資料設定 X 狀態管理 slice」、「根據規格開發可重複使用的 Y 組件」)。
- 識別是否有任何現有的 user stories 因前端架構決策而需要調整其驗收標準 (例如，指定 UI 元素的互動細節、組件使用或效能考量)。
- 與使用者協作定義這些新增或調整。
- 準備一份簡潔的摘要，詳細說明與前端相關的 epics 和 user stories 的所有建議新增、更新或修改。如果未識別任何變更，則明確說明 (例如，「前端架構未識別對現有 epics/stories 的直接影響」)。

### 14. 檢查清單審查與最終定案

- 一旦 `front-end-architecture` 已填寫完畢並與使用者一同審查，且已總結 epic/story 影響，請使用 `frontend-architecture-checklist`。
- 逐項檢查清單，以確保 `front-end-architecture` 的完整性，且所有章節都已充分處理 - 對於每個檢查清單項目，您必須考量其是否真正完整或有缺陷。
- 對於每個檢查清單章節，確認其狀態 (例如，[x] 已完成，[ ] 不適用，[!] 需要注意)。
- 如果發現某章節存在缺陷或需要更詳細的內容：
  - 與使用者討論這些問題。
  - 協作對 `front-end-architecture` 進行必要的更新或補充。
- 在處理完所有要點並確保文件穩健後，向使用者呈現檢查清單審查的摘要。此摘要應強調：
  - 確認檢查清單的所有相關章節均已滿足。
  - 任何標記為不適用的項目及其簡要原因。
  - 關於因檢查清單審查而進行的任何重要討論或變更的簡要說明。
- 目標是確保 `front-end-architecture` 是一份完整且可執行的文件。
