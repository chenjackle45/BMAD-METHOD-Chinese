# Core Dump 任務

## 目的

建立一份簡明的記憶體記錄檔（`.ai/core-dump-n.md`），用以捕捉當前 agent 工作階段的關鍵脈絡，讓未來的 agent 工作階段能無縫延續作業。本任務確保 agent 對話間的脈絡能持續保存，同時以最少的 token 使用量達到高效脈絡載入。

## 本任務所需輸入

- 當前工作階段的對話紀錄與已完成事項
- 工作階段內建立、修改或刪除的檔案
- 關鍵決策與執行過的程序
- 當前專案狀態與下一步合理行動
- 影響本階段的使用者請求與 agent 回應

## 任務執行指引

### 0. 檢查現有 Core Dump

在繼續前，請先檢查 `.ai/core-dump.md` 是否已存在：

- 若檔案已存在，請詢問使用者：「Core dump 檔案已存在。請問要：1. 覆蓋、2. 更新、3. 附加，或 4. 建立新檔？」
- **覆蓋**：以新內容取代整份檔案
- **更新**：將本次工作階段資訊與現有內容合併，並更新相關區段
- **附加**：將本次工作階段作為新條目加入，保留原有內容
- **建立新檔**：建立新檔案，檔名依序遞增，如已有 1 與 2，則建立 core-dump-3.md
- 若檔案不存在，請直接建立 `core-dump-1.md`

### 1. 分析工作階段脈絡

- 檢視整段對話，找出主要完成事項
- 記錄執行過的具體任務、程序或工作流程
- 辨識重要決策或已解決的問題
- 捕捉本階段觀察到的使用者工作風格與偏好

### 2. 紀錄已完成事項

- **主要行動**：簡明列出已完成的主要任務
- **Story 進度**：針對 story 工作，請用「Tasks Complete: 1-6, 8. Next Task Pending: 7, 9」格式
- **問題解決**：記錄遇到的挑戰及解決方式
- **使用者溝通**：摘要關鍵的使用者請求、偏好與討論重點

### 3. 記錄檔案系統變動（簡明格式）

- **新增檔案**：`filename.ext`（簡述用途／大小）
- **修改檔案**：`filename.ext`（說明變動內容）
- **刪除檔案**：`filename.ext`（說明刪除原因）
- 著重於關鍵細節，避免冗長描述

### 4. 捕捉當前專案狀態

- **專案進度**：本階段結束後專案所處狀態
- **當前問題**：尚待解決的阻礙或問題
- **下一步行動**：合理的後續行動建議

### 5. 建立／更新 Core Dump 檔案

根據第 0 步使用者選擇，依指示處理檔案：

### 6. 優化脈絡內容以精簡為主

- 保持描述簡明但具資訊性
- 優先採用簡化格式（如檔案大小、任務編號）
- 著重於可執行資訊，避免冗長說明
- 避免重複專案文件中已有的資訊
- 優先保留若未記錄將遺失的重要資訊
- 確保檔案可快速瀏覽並理解

### 7. 驗證完整性

- 確認所有重要的工作階段活動皆已記錄
- 確保未來 agent 能理解當前狀態
- 檢查檔案變動紀錄是否正確
- 確認後續行動明確且可執行
- 驗證已記錄使用者溝通風格與偏好
